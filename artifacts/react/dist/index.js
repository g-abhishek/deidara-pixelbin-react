!function(t,r){for(var e in r)t[e]=r[e]}(exports,function(t){var r={};function e(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,r){if(1&r&&(t=e(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var o in t)e.d(n,o,function(r){return t[r]}.bind(null,o));return n},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},e.p="",e(e.s=4)}([function(t,r){t.exports=require("react")},function(t,r){t.exports=require("axios")},function(t,r){t.exports=require("async-retry")},function(t,r){t.exports=require("node-common")},function(t,r,e){"use strict";e.r(r),e.d(r,"PixelBinImage",(function(){return _})),e.d(r,"PixelBinDownloadButton",(function(){return z}));var n=e(0),o=e.n(n),u=e(1),i=e.n(u),c=e(2),a=e.n(c),f=e(3);function l(t){return f.url.objToUrl(t)}function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function p(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function y(t,r){if(r&&("object"===s(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function b(t){var r="function"==typeof Map?new Map:void 0;return(b=function(t){if(null===t||(e=t,-1===Function.toString.call(e).indexOf("[native code]")))return t;var e;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,n)}function n(){return d(t,arguments,h(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),O(n,t)})(t)}function d(t,r,e){return(d=v()?Reflect.construct:function(t,r,e){var n=[null];n.push.apply(n,r);var o=new(Function.bind.apply(t,n));return e&&O(o,e.prototype),o}).apply(null,arguments)}function v(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function O(t,r){return(O=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t})(t,r)}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var m=function(t){!function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&O(t,r)}(c,t);var r,e,n,o,u,i=(r=c,e=v(),function(){var t,n=h(r);if(e){var o=h(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return y(this,t)});function c(t){var r;return function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,c),(r=i.call(this,t)).name="PDKIllegalArgumentError",r}return n=c,o&&p(n.prototype,o),u&&p(n,u),Object.defineProperty(n,"prototype",{writable:!1}),n}(b(Error)),j=["url","urlObj","onLoad","onError","onExhausted","retryOpts","LoaderComponent"];function g(){return(g=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t}).apply(this,arguments)}function w(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),e.push.apply(e,n)}return e}function P(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?w(Object(e),!0).forEach((function(r){x(t,r,e[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):w(Object(e)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}))}return t}function x(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}function S(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var n,o,u=[],i=!0,c=!1;try{for(e=e.call(t);!(i=(n=e.next()).done)&&(u.push(n.value),!r||u.length!==r);i=!0);}catch(t){c=!0,o=t}finally{try{i||null==e.return||e.return()}finally{if(c)throw o}}return u}(t,r)||function(t,r){if(!t)return;if("string"==typeof t)return E(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return E(t,r)}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function k(t,r){if(null==t)return{};var e,n,o=function(t,r){if(null==t)return{};var e,n,o={},u=Object.keys(t);for(n=0;n<u.length;n++)e=u[n],r.indexOf(e)>=0||(o[e]=t[e]);return o}(t,r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(t);for(n=0;n<u.length;n++)e=u[n],r.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(t,e)&&(o[e]=t[e])}return o}function R(t,r,e,n,o,u,i){try{var c=t[u](i),a=c.value}catch(t){return void e(t)}c.done?r(a):Promise.resolve(a).then(n,o)}var T={retries:3,backOffFactor:2,interval:500};function D(t,r,e){return a()(function(){var e,n=(e=regeneratorRuntime.mark((function e(n){var o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.a.get(t,{withCredentials:!1,responseType:"blob",cancelToken:r,validateStatus:function(t){return 200===t}});case 3:return o=e.sent,e.abrupt("return",o);case 7:if(e.prev=7,e.t0=e.catch(0),202!==(null===(u=e.t0.response)||void 0===u?void 0:u.status)){e.next=11;break}return e.abrupt("return",Promise.reject(e.t0));case 11:n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,7]])})),function(){var t=this,r=arguments;return new Promise((function(n,o){var u=e.apply(t,r);function i(t){R(u,n,o,i,c,"next",t)}function c(t){R(u,n,o,i,c,"throw",t)}i(void 0)}))});return function(t){return n.apply(this,arguments)}}(),{retries:e.retries,factor:e.backOffFactor,minTimeout:e.interval})}var _=function(t){var r=t.url,e=t.urlObj,u=t.onLoad,c=void 0===u?function(){}:u,a=t.onError,f=void 0===a?function(){}:a,s=t.onExhausted,p=void 0===s?function(){}:s,y=t.retryOpts,b=void 0===y?{}:y,d=t.LoaderComponent,v=k(t,j),O=Object(n.useRef)(),h=S(Object(n.useState)(!0),2),w=h[0],x=h[1],E=S(Object(n.useState)(),2),R=E[0],_=E[1];return Object(n.useEffect)((function(){if(!r&&!e)return f(new m("Please provide either `url` or `urlObj` prop"));try{r=e?l(e):r}catch(t){return f(t)}var t=!1,n=i.a.CancelToken.source();return x(!0),_(!1),D(r,n.token,P(P({},T),b)).then((function(r){t||(_(!0),O.current.src=URL.createObjectURL(r.data))})).catch((function(r){var e;if(!t)return 202!==(null===(e=r.response)||void 0===e?void 0:e.status)?f(r):void p(r)})).finally((function(){return x(!1)})),function(){t=!0,n.cancel("Cancelling in cleanup"),O.current&&URL.revokeObjectURL(O.current.src)}}),[r,e]),w&&d?o.a.createElement(d,null):R?o.a.createElement("img",g({src:"undefined"==typeof window?r:"","data-testid":"pixelbin-image"},v,{ref:O,onLoad:c,onError:f})):o.a.createElement("img",{"data-testid":"pixelbin-empty-image"})},A=["children","url","urlObj","retryOpts","onDownloadStart","onDownloadFinish","onError","onExhausted"];function C(){return(C=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t}).apply(this,arguments)}function I(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),e.push.apply(e,n)}return e}function L(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?I(Object(e),!0).forEach((function(r){F(t,r,e[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):I(Object(e)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}))}return t}function F(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}function M(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var n,o,u=[],i=!0,c=!1;try{for(e=e.call(t);!(i=(n=e.next()).done)&&(u.push(n.value),!r||u.length!==r);i=!0);}catch(t){c=!0,o=t}finally{try{i||null==e.return||e.return()}finally{if(c)throw o}}return u}(t,r)||function(t,r){if(!t)return;if("string"==typeof t)return U(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return U(t,r)}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function B(t,r){if(null==t)return{};var e,n,o=function(t,r){if(null==t)return{};var e,n,o={},u=Object.keys(t);for(n=0;n<u.length;n++)e=u[n],r.indexOf(e)>=0||(o[e]=t[e]);return o}(t,r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(t);for(n=0;n<u.length;n++)e=u[n],r.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(t,e)&&(o[e]=t[e])}return o}function q(t,r,e,n,o,u,i){try{var c=t[u](i),a=c.value}catch(t){return void e(t)}c.done?r(a):Promise.resolve(a).then(n,o)}var $={retries:3,backOffFactor:2,interval:500},K=function(t,r,e){return a()(function(){var e,n=(e=regeneratorRuntime.mark((function e(n){var o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.a.head(t,{cancelToken:r,validateStatus:function(t){return 200===t}});case 3:return o=e.sent,e.abrupt("return",o);case 7:if(e.prev=7,e.t0=e.catch(0),202!==(null===(u=e.t0.response)||void 0===u?void 0:u.status)){e.next=11;break}return e.abrupt("return",Promise.reject(e.t0.response));case 11:n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,7]])})),function(){var t=this,r=arguments;return new Promise((function(n,o){var u=e.apply(t,r);function i(t){q(u,n,o,i,c,"next",t)}function c(t){q(u,n,o,i,c,"throw",t)}i(void 0)}))});return function(t){return n.apply(this,arguments)}}(),{retries:e.retries,factor:e.backOffFactor,minTimeout:e.interval})};function z(t){var r=t.children,e=t.url,u=t.urlObj,c=t.retryOpts,a=void 0===c?{}:c,f=t.onDownloadStart,s=void 0===f?function(){}:f,p=t.onDownloadFinish,y=void 0===p?function(){}:p,b=t.onError,d=void 0===b?function(){}:b,v=t.onExhausted,O=void 0===v?function(){}:v,h=B(t,A),j=M(Object(n.useState)(!1),2),g=j[0],w=j[1];Object(n.useEffect)((function(){return function(){return w(!0)}}),[]);return o.a.createElement("button",C({"data-testid":"pixelbin-download-button"},h,{onClick:function(t){if(t.stopPropagation(),!e&&!u)return d(new m("Please provide either `url` or `urlObj` prop"));try{e=u?l(u):e}catch(t){return d(t)}var r=i.a.CancelToken.source();w(!1),s(),K("".concat(e,"?download=true"),r.token,L(L({},$),a)).then((function(){if(!g){y();var t=document.createElement("a");t.href="".concat(e,"?download=true"),t.download="pixelbin-transformed",t.click()}})).catch((function(t){var r;if(!g){if(console.log(t),202!==(null===(r=t.response)||void 0===r?void 0:r.status))return d(t);O(t)}}))}}),r)}}]));